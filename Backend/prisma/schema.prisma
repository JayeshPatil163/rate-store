generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ## USER MODEL ##
// Corresponds to userSchema.
model User {
  id        String    @id @default(cuid()) // Unique ID for the user
  name      String    // Validation for min/max length is handled in your backend code.
  email     String    @unique // Enforces that every email in the database is unique.
  password  String    // The hashed password will be stored here.
  address   String?   // The '?' makes this field optional. Max length is handled in backend.
  role      UserRole  // Uses the UserRole enum defined below for type safety.
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  ownedStores Store[]
  ratings     Rating[]
}

// ## STORE MODEL ##
// Corresponds to storeSchema.
model Store {
  id                String    @id @default(cuid())
  name              String
  email             String    @unique // Enforces unique email for each store.
  address           String    // Max length is handled in your backend code.
  averageRating     Float     @default(0)
  totalRatingsCount Int       @default(0)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt
  storeOwnerId String
  storeOwner   User     @relation(fields: [storeOwnerId], references: [id])
  ratings      Rating[]
}

// ## RATING MODEL ##
// Corresponds to ratingSchema.
model Rating {
  id        String   @id @default(cuid())
  rating    Int    
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  userId String
  user   User   @relation(fields: [userId], references: [id])
  storeId String
  store   Store  @relation(fields: [storeId], references: [id])

  @@unique([userId, storeId])
}

enum UserRole {
  Normal_User
  Store_Owner
  System_Administrator
}